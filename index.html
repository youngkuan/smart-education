<!DOCTYPE html>
<html>

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible">
  <title>智慧教育示范应用</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- csdn 设置了图片防盗链 -->
  <meta name="referrer" content="no-referrer">
  <script type="text/javascript" charset="utf-8">
    (function () {
      var trust = ["localhost", "127.0.0.1", "yotta.xjtushilei.com", "47.95.145.72"];
      var referrer = document.referrer;
      var sign = "://";
      var pos = referrer.indexOf(sign) + sign.length;
      referrer = referrer.slice(pos).split("/")[0].split(":")[0];
      //if (trust.join("-").indexOf(referrer) === -1 || referrer === null || referrer === "") window.location.href = 'http://www.xjtudlc.com';
    })();
  </script>
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="./css/base.css" type="text/css">
  <!-- Font Awesome -->
  <link href="http://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <!-- Ionicons -->
  <link href="http://cdn.bootcss.com/ionicons/2.0.0/css/ionicons.min.css" rel="stylesheet">
  <!-- Theme style -->
  <link rel="stylesheet" href="./dist/css/AdminLTE.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="./dist/css/skins/_all-skins.min.css">
  <link rel="stylesheet" href="./bootstrap/css/bootstrap-directional-buttons.css">

  <style>
    path,
    line {
      stroke: #777;
    }

    text {
      font-family: Microsoft YaHei;
    }

    .leafMessage {
      /*width:300px;*/
      height: 250px;
      overflow: scroll;
    }
  </style>

  <link rel="stylesheet" href="./plugins/jQuery/jquery.qtip.css" />

  <link rel="shortcut icon" href="./images/ico/forest3/favicon.ico">
  <link rel="apple-touch-icon-precomposed" sizes="128x128" href="./images/ico/forest3/forest_128.png">
  <link rel="apple-touch-icon-precomposed" sizes="96x96" href="./images/ico/forest3/forest_96.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="./images/ico/forest3/forest_72.png">
  <link rel="apple-touch-icon-precomposed" href="./images/ico/forest3/forest_64.png">

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body class="hold-transition skin-blue sidebar-collapse">
  <div class="wrapper">

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper" ng-app="app" ng-controller="yangkuanController">
      <!-- Content Header (Page header) -->
      <section class="content-header">
        <h1>
          智慧教育示范应用
          <small>课程：
            <a>{{ domainname }}</a>
            &nbsp;&nbsp;主题数：
            <a id="sumtopic"></a>
          </small>
        </h1>
      </section>

      <!-- Main content -->
      <section class="content">

        <div class="row" style="">
          <div class="col-md-2" style="height: 165px;">
            <div class="box box-primary" style="height:88%;text-align:center;">
              <div class="box-header with-border">
                <h3 class="box-title">知识主题推荐学习</h3>

              </div>
              <div class="box-body" style="padding: 0;">
                <button type="button" style="border: 0" data-toggle="modal" data-target="#learningstatus" ng-click="post_log_of_mouseclick_Global_Graph('学习页面');">
                  <img src="images/ico/forest3/forest_128.png" style="height: 90px;" />
                </button>
              </div>
              <div class="modal fade" id="learningstatus">
                <div class="modal-dialog" style="width: 1600px">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                      <h3 class="modal-title">
                        知识森林鸟瞰图
                      </h3>
                    </div>
                    <div class="modal-body" style="overflow: auto;">
                      <div class="row">
                        <div class="col-xs-8 col-md-8">
                          <div id="mydiv2">
                            <div class='panel panel-info'>
                              <div class='panel-heading'>
                                <h3 class='panel-title'>
                                  <i class="glyphicon glyphicon-tree-conifer"></i> 知识森林概览</h3>
                              </div>
                              <div class='panel-body' data-spy="scroll" style="height:680px;overflow:hidden; position: relative;">
                                <div id="echarts1" style="width: 100%;height:650px"></div>
                              </div>
                            </div>
                          </div>
                        </div>

                        <div class="col-xs-4 col-md-4">
                          <div id="mydiv1">
                            <div class='panel panel-info'>
                              <div class='panel-heading'>
                                <h3 class='panel-title'>
                                  <i class="glyphicon glyphicon-tree-deciduous"></i> 主题分面树</h3>
                              </div>
                              <div class='panel-body' data-spy="scroll" style="height:680px;overflow:hidden; position: relative;">
                                <div id="mysvg2" style="width: 100%;height:680px">
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                    </div>
                  </div>
                  <!-- /.modal-content -->
                </div>
                <!-- /.modal-dialog -->
              </div>
            </div>
          </div>
          <div class="col-md-8" style="height: 165px">
            <div class="box box-primary" style="height: 88%;">
              <!-- 此处是推荐的一系列知识主题
                    鼠标移动到主题自动显示分面学习状态 -->
              <div class="box box-solid" style="padding-left: 4px;padding-right: 4px">
                <div class="box-header with-border">
                  <h3 class="box-title">主题推荐
                    <small>

                      <a id="learnt" ng-style="color[2]"></a>

                      <a id="learning" ng-style="color[1]"></a>

                      <a id="willlearn" ng-style="color[0]"></a>
                    </small>
                  </h3>
                </div>
                <div class="box-body">
                  <div class="row">
                    <div class="col-md-1" style="z-index: 100;">
                      <button type="button" class="btn btn-primary btn-lg" style="width:100%" ng-click="topicIndex = (topicIndex - 1 < 0 ) ? 0 : topicIndex - 1">
                        <i class="fa fa-angle-left"></i>
                      </button>
                    </div>
                    <!-- 四种推荐 -->
                    <div class="col-md-2" ng-repeat="topic in (currTopics.length > 5 ? currTopics.slice(topicIndex,topicIndex+5) : currTopics) " style="padding-left: 0%">
                    <!-- 所有主题推荐 -->
                    <!-- <div class="col-md-2" ng-repeat="topic in (topics.length > 5 ? topics.slice(topicIndex,topicIndex+5) : topics) " style="padding-left: 0%"> -->
                      <div class="btn-group dropdown" ng-if="states != null">
                        <button type="button" class="btn btn-primary btn-lg btn-arrow-right dropdown-toggle" data-boundary="viewport" data-toggle="dropdown" data-hover="dropdown"
                          ng-mouseover="getFacetsByTopicName(topic.topicName);showdropdown=true" ng-mouseleave="showdropdown=false"
                          ng-click="getFacetsByTopicNameThroughClick(topic.topicName);getAssemblesByTopicName(topic.topicName);showdropdown = false;
                          post_log_of_mouseover_topic('学习页面',topic.topicName,topic.topicId);updateState();" ng-style="updateBackColor(topic.state)">
                          {{topic.topicName.split(" ")[0]}}
                          </button>
                        <ul class="dropdown-menu" role="menu" ng-if="showdropdown" style="margin-top: 0px;width: 100%;padding: 0px;z-index: 800;">
                          <li class=" list-group-item" ng-repeat="firstLayerFacet in facets " style="background-color: white;padding: 0px">
                            <div class=" list-group-item" ng-style="backcolor[{{topic.state}}]">
                              <a id={{firstLayerFacet.firstLayerFacetName}}_choose ng-click="" style="color:white;cursor:pointer">{{firstLayerFacet.firstLayerFacetName}}
                              </a>
                              <a id={{firstLayerFacet.firstLayerFacetName}}_a class="fa fa-fw fa-chevron-left" style="float:right;color:white;cursor:pointer"
                                ng-click="isCollapsed =!isCollapsed;" ng-hide="firstLayerFacet.secondLayerFacets.length==0">
                              </a>
                            </div>
                            <ul uib-collapse="false" collapsed="coled()" collapsing="coling()" expanded="exped()" expanding="exping()" class="level2"
                              ng-repeat="secondLayerFacet in firstLayerFacet.secondLayerFacets">
                              <div class="list-group-item " style="margin:2px 0;" ng-style="backcolor[{{topic.state}}]">
                                <a id={{firstLayerFacet.firstLayerFacetName}}_{{secondLayerFacet.secondLayerFacetName}}_choose style="color:white;cursor:pointer"
                                  ng-click="">{{secondLayerFacet.secondLayerFacetName}}</a>
                                <a id={{firstLayerFacet.firstLayerFacetName}}_{{secondLayerFacet.secondLayerFacetName}}__a class="fa fa-fw fa-chevron-left"
                                  style="float:right;color:white;cursor:pointer" ng-click="isCollapsedchildren = !isCollapsedchildren;"
                                  ng-hide="secondLayerFacet.thirdLayerFacets.length==0"></a>
                              </div>
                            </ul>
                      </div>
                    </div>

                    <div class="col-md-1" style="z-index: 100;">
                      <!-- 四种推荐 -->
                      <button type="button" class="btn btn-primary btn-lg" style="width:100%" ng-click="topicIndex = ( topicIndex + 5 >= currTopics.length) ? topicIndex : topicIndex + 1">
                      <!-- 所有主题推荐 -->
                      <!-- <button type="button" class="btn btn-primary btn-lg" style="width:100%" ng-click="topicIndex = ( topicIndex + 5 >= topics.length) ? topicIndex : topicIndex + 1"> -->
                        <i class="fa fa-angle-right"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
          <div class="col-md-2" style="height:165px">
            <div class="box box-primary" style="height:88%;">
              <!-- 此处是主题推荐方式的选择 -->

              <div class="box box-solid" style="padding-left: 4px;padding-right: 4px;text-align: center">
                <div class="box-header with-border">
                  <h3 class="box-title">主题推荐方式</h3>
                </div>
                <div class="box-body" style="padding: 18px">
                  <div class="btn-group dropdown">
                    <button type="button" class="btn bg-purple btn-lg dropdown-toggle" data-toggle="dropdown">{{shownname}}</button>
                    <ul class="dropdown-menu" role="menu" style="margin-top: 0px;min-width: 100%">
                      <li ng-repeat="x in recnames" style="">
                        <button type="button" style="background-color: white;width:100%;" class="dropdown-item btn btn-light" href="#" ng-disabled="disableRecForNewbie(x)" ng-click="updateRecname(x);post_log_of_mouseclick_recommendation('学习页面',x)">{{x}}</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-3 col-md-3">
            <!-- 此处是主题分面的信息 -->
            <div class="box box-primary" style="height: 100%;">
              <div class="box-header with-border">
                <h3 class="box-title" id="class_name"><b ng-if="currentTopicName">{{currentTopicName + " - "}}</b>分面展示</h3>
              </div>
              <div id="facetClassDiv" class="box-body">
                <ul class="list-group" style="display:block; overflow-y:auto; height:600px;padding: 0px;font-size: 20px">
                  <li class=" list-group-item" ng-repeat="firstLayerFacet in clickfacets " style="background-color: white">
                    <div class=" list-group-item" style="background-color:#4682B4;">
                      <a id={{firstLayerFacet.firstLayerFacetName}}_choose ng-click="clickChangeColor($event);getAssemblesByTopicNameAndFirstLayerFacetName(firstLayerFacet.topicName,firstLayerFacet.firstLayerFacetName);
                      post_log_of_mouseclick_facet('学习页面','点击-1级分面',firstLayerFacet.topicName,firstLayerFacet.topicId
                              ,firstLayerFacet.firstLayerFacetName,firstLayerFacet.firstLayerFacetId,null,null);" style="color:white;cursor:pointer">{{firstLayerFacet.firstLayerFacetName}}
                      </a>
                      <a id={{firstLayerFacet.firstLayerFacetName}}_a class="fa fa-fw fa-chevron-left" style="float:right;color:white;cursor:pointer"
                        ng-click="isCollapsed =!isCollapsed;" ng-hide="firstLayerFacet.secondLayerFacets.length==0">
                      </a>
                    </div>
                    <ul class="list-group" uib-collapse="isCollapsed" collapsed="coled()" collapsing="coling()" expanded="exped()" expanding="exping()" class="level2"
                      ng-repeat="secondLayerFacet in firstLayerFacet.secondLayerFacets" style="margin-left: 40px;margin-bottom: 0px">
                      <div class="list-group-item " style="background-color: #3c8dbc;margin:2px 0;">
                        <a id={{firstLayerFacet.firstLayerFacetName}}_{{secondLayerFacet.secondLayerFacetName}}_choose style="color:white;cursor:pointer"
                          ng-click="clickChangeColor($event);getAssemblesByTopicNameAndsecondLayerFacetName(secondLayerFacet.topicName,secondLayerFacet.secondLayerFacetName,firstLayerFacet.firstLayerFacetName);
                          post_log_of_mouseclick_facet('学习页面','点击-2级分面',firstLayerFacet.topicName,firstLayerFacet.topicId
                                  ,firstLayerFacet.firstLayerFacetName,firstLayerFacet.firstLayerFacetId,secondLayerFacet.secondLayerFacetName,secondLayerFacet.secondLayerFacetId);">
                          {{secondLayerFacet.secondLayerFacetName}}</a>
                        <a id={{firstLayerFacet.firstLayerFacetName}}_{{secondLayerFacet.secondLayerFacetName}}__a class="fa fa-fw fa-chevron-left"
                          style="float:right;color:white;cursor:pointer" ng-click="isCollapsedchildren = !isCollapsedchildren;"
                          ng-hide="secondLayerFacet.thirdLayerFacets.length==0"></a>
                      </div>
                    </ul>
                  </li>
                </ul>
              </div>
              <div>
              </div>
            </div>
          </div>
          <div class="col-xs-9 col-md-9">
            <div class="box box-primary" style="margin-bottom:2px;">
              <!-- 此处是碎片信息 -->
              <div class="box-header with-border">
                <h4><b ng-if="currentTopicName == null">{{domainname + " - "}}</b><b ng-if="currentTopicName">{{currentTopicName + " - "}}</b><b ng-if="currentFirstLayerFacetName">{{currentFirstLayerFacetName + " - "}}</b><b ng-if="currentSecondLayerFacetName">{{currentSecondLayerFacetName + " - "}}</b>碎片数量：{{ assembleNumber }}</h4>
                <!-- <p>问题数量：</p> -->
              </div>
            </div>
            <div style="overflow:auto; height:600px;">

              <div class="box box-solid" ng-repeat="assemble in assembles">
                <!-- <div class="box box-solid box-primary" ng-repeat="fragment in fragments"> -->
                <!-- <div class="box box-solid box-success" ng-repeat="fragment in fragments"> -->
                <!-- <div class="box box-solid box-warning" ng-repeat="fragment in fragments"> -->

                <!-- 问题碎片的主题、分面和数据源信息 -->
                <div class="box-header with-border" id="q_{{ assemble.assembleId }}">

                  <!-- 问题碎片的主题、分面和数据源信息 -->
                  <h1 class="box-title">
                    <small>
                      分面:
                      <span class="badge bg-purple">
                        <a style="color: white" target="_blank">{{ assemble.firstLayerFacetName }}</a>
                      </span>
                      &nbsp;&nbsp;&nbsp; 数据源:
                      <span class="badge bg-yellow">
                        <a style="color: white" target="_blank">{{ assemble.sourceName }}</a>
                      </span>

                    </small>
                  </h1>
                  <!-- 缩放按钮 -->
                  <!--                           <div class="box-tools pull-right">
                            <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip">
                              <i class="fa fa-minus"></i>
                            </button>
                          </div> -->
                </div>

                <div class="box-body" style="height: 70px; overflow: hidden;">
                  <!-- <div ng-if="assemble.assembleText.length < 220"> -->

                  <!-- 问题正文 -->
                  <!-- 超过两行隐藏并添加省略号 -->
                  <p style="display: -webkit-box;-webkit-line-clamp:2;-webkit-box-orient: vertical;line-height: 30px;font-size: 20px;height: 60px;overflow: hidden;"
                    ng-bind="assemble.assembleText">

                  </p>

                </div>
                <!-- /.box-body -->

                <div class="box-footer" style="text-align: center;">
                  <button type="button" style="background: white;border: 0;" data-toggle="modal" data-target="#q_{{ assemble.assembleId }}_modal" data-backdrop="static" data-keyboard="false" ng-click="videoOrNot(assemble.assembleText)">
                    <i class="fa fa-fw fa-angle-double-down" ng-click="post_log_of_mouseclick_assemble('学习页面',assemble.topicName,assemble.topicId,
                    assemble.firstLayerFacetName,assemble.firstLayerFacetId,assemble.secondLayerFacetName,assemble.secondLayerFacetId,assemble.assembleId);"></i>
                  </button>
                </div>
                <div class="modal fade" id="q_{{ assemble.assembleId }}_modal">
                  <div class="modal-dialog" style="width: 1000px">
                    <div class="modal-content">
                      <div class="modal-header">
                        <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button> -->
                        <h4 class="modal-title">
                          <b ng-if="currentTopicName == null">{{domainname + " - "}}</b><b ng-if="currentTopicName">{{currentTopicName + " - "}}</b><b ng-if="currentFirstLayerFacetName">{{currentFirstLayerFacetName + " - "}}</b><b ng-if="currentSecondLayerFacetName">{{currentSecondLayerFacetName + " - "}}</b>知识碎片
                          <small>
                            <!-- 分面:
                            <span class="badge bg-purple">
                              <a style="color: white" target="_blank">{{ assemble.firstLayerFacetName }}</a>
                            </span> -->
                            &nbsp;&nbsp;&nbsp; 数据源:
                            <span class="badge bg-yellow">
                              <a style="color: white" target="_blank">{{ assemble.sourceName }}</a>
                            </span>

                          </small>
                        </h4>
                      </div>
                      <div ng-if="! isVideo" class="modal-body" style="overflow: auto;line-height: 40px;font-size:25px;padding-left: 20px;padding-right: 20px;">
                        <p style="width: 100%;height: auto;word-wrap:break-word;word-break:break-all;overflow: hidden;" ng-bind-html="deletePrefixWitheFile(assemble.assembleContent)"></p>
                        <!-- <p>{{assemble.assembleText}}</p> -->
                      </div>
                      <div ng-if="isVideo" class="modal-body" style="overflow: auto;line-height: 40px;font-size:25px;padding-left: 20px;padding-right: 20px;">
                        <video ng-src="{{trustSrc(videourl)}}" style="width: 100%" controls="controls"></video>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" ng-click="pauseVideo();updateState();" data-dismiss="modal">Close</button>
                      </div>
                    </div>
                    <!-- /.modal-content -->
                  </div>
                  <!-- /.modal-dialog -->
                </div>
                <!-- /.modal -->
              </div>
            </div>

          </div>
        </div>
      </section>
      <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <footer class="main-footer">
      <div class="pull-right hidden-xs">
        <b>Version</b> 1.0.1
      </div>
      <!-- <strong>Copyright &copy; 2017 智能网络与网络安全教育部重点实验室.</strong> All rights reserved. -->
      <strong>Copyright &copy; 2018 大数据算法与分析技术国家工程实验室.</strong> All rights reserved.
    </footer>


    <!-- /.control-sidebar -->
    <!-- Add the sidebar's background. This div must be placed
         immediately after the control sidebar -->
    <div class="control-sidebar-bg"></div>
  </div>
  <!-- ./wrapper -->


  <script src="./plugins/jQuery/jquery-2.2.3.min.js"></script>
  <script src="./plugins/d3js/d3.js" charset="utf-8"></script>
  <script src="./plugins/datguijs/dat.gui.min.js"></script>
  <script src="./plugins/jQuery/jquery.qtip.js"></script>
  <script src="./plugins/jQuery/jquery-ui.js"></script>
  <script src="./plugins/angularjs/angular.min.js"></script>
  <script src="./plugins/angularjs/angular-animate.js"></script>
  <script src="./plugins/angularjs/angular-sanitize.js"></script>
  <script src="./plugins/ui-bootstrap/ui-bootstrap-tpls.js"></script>
  <script src="./plugins/ui-bootstrap/ui-bootstrap.js"></script>
  <script src="./bootstrap/js/bootstrap.min.js"></script>
  <script src="./plugins/echartjs/echarts.min-kg.js"></script>
  <script src="./plugins/dataTooljs/dataTool.js"></script>

  <script src="./js/buildSimpleTree.js"></script>
  <script src="./js/drawMap.js"></script>

  <!-- 日志收集----请确保：此文件之前有jquery！！！ -->
  <script type="text/javascript" src="./js/post-log-SDK.js"></script>
  <script type="text/javascript" charset="utf-8" async>
    var log_server_url = "http://yotta.xjtushilei.com:8090" //该声明可以在调用sdk中两个函数之前的任意位置！！！
    // var log_server_url = "http://localhost:8090" //该声明可以在调用sdk中两个函数之前的任意位置！！！
    post_log_of_visit();
  </script>
  <!-- 日志收集----请确保：自己写的js文件在此位置之后，保证post_log_of_action()函数之前被浏览器加载！！！ -->

  <script language="javascript" type="text/javascript" src="./js/function.js"></script>
</body>

</html>